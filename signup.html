<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>IXH – Sign Up</title>
  <link rel="stylesheet" href="assets/styles.css">
  <link rel="stylesheet" href="assets/manual.css">
</head>
<body>
  <main class="container">
    <h1 class="title">Sign Up</h1>

    <div class="card">
      <p class="muted">Note: All fields are required.</p>
      <form id="signupForm" class="form">
        <div class="field">
          <label for="name">Full Name</label>
          <input id="name" name="name" type="text" class="input" required>
        </div>

        <div class="field">
          <label for="address">Mailing Address</label>
          <textarea id="address" name="address" class="input" rows="3" required></textarea>
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" class="input" required>
        </div>

        <!-- NEW: Wallet -->
        <div class="field">
          <label for="wallet">XRP Wallet Address (classic)</label>
          <input id="wallet" name="wallet" type="text" class="input"
                 placeholder="rPqbs9C8r5L4g5dtTyn3UeWhXNywngri5j"
                 pattern="^r[1-9A-HJ-NP-Za-km-z]{24,34}$" required>
          <small class="hint">Must start with <b>r</b> and be 25–35 base58 characters (no 0,O,I,l).</small>
        </div>

        <div class="field">
          <label for="nationality">Nationality</label>
          <input id="nationality" name="nationality" type="text" class="input" required>
        </div>

        <div class="grid">
          <div class="field">
            <label for="xrpTag">Your XRP Tag ID (10 digits)</label>
            <input id="xrpTag" name="xrpTag" type="text" class="input" inputmode="numeric" pattern="^\d{10}$" required>
          </div>
          <div class="field">
            <label for="succTag">Successor Tag ID (10 digits)</label>
            <input id="succTag" name="succTag" type="text" class="input" inputmode="numeric" pattern="^\d{10}$" required>
          </div>
        </div>

        <div class="field">
          <label for="telegram">Telegram Username</label>
          <input id="telegram" name="telegram" type="text" class="input" placeholder="@username" required>
        </div>

        <div class="actions">
          <button type="submit" class="btn primary">Submit</button>
        </div>
      </form>

      <div id="result" class="result" hidden></div>
    </div>
  </main>

  <script>
    (function(){
      const BASE = new URL(window.location.href);
      // If you published your Apps Script as a Web App, replace with that URL:
      const APP_URL = BASE.origin + BASE.pathname.replace(/\/[^\/]*$/, '/exec'); // same folder → /exec

      const form = document.getElementById('signupForm');
      const result = document.getElementById('result');

      function show(msg, ok) {
        result.hidden = false;
        result.textContent = msg;
        result.className = 'result ' + (ok ? 'ok' : 'err');
      }

      form.addEventListener('submit', async (ev) => {
        ev.preventDefault();

        const name = form.name.value.trim();
        const address = form.address.value.trim();
        const email = form.email.value.trim();
        const wallet = form.wallet.value.trim();
        const nationality = form.nationality.value.trim();
        const xrpTag = form.xrpTag.value.trim();
        const succTag = form.succTag.value.trim();
        const telegram = form.telegram.value.trim();

        const reWallet = /^r[1-9A-HJ-NP-Za-km-z]{24,34}$/;
        if (!reWallet.test(wallet)) {
          show('Invalid XRP wallet address (must be classic r-address).', false);
          form.wallet.focus();
          return;
        }
        if (!/^\d{10}$/.test(xrpTag)) { show('XRP Tag ID must be 10 digits.', false); form.xrpTag.focus(); return; }
        if (!/^\d{10}$/.test(succTag)) { show('Successor Tag ID must be 10 digits.', false); form.succTag.focus(); return; }

        const payload = new URLSearchParams();
        payload.set('action', 'signup');
        payload.set('name', name);
        payload.set('address', address);
        payload.set('email', email);
        payload.set('wallet', wallet); // NEW
        payload.set('nationality', nationality);
        payload.set('xrpTag', xrpTag);
        payload.set('succTag', succTag);
        payload.set('telegram', telegram);
        payload.set('clientTs', new Date().toISOString());

        try {
          const r = await fetch(APP_URL, { method:'POST', body: payload });
          const j = await r.json();
          if (j.ok) {
            show('Sign-up saved. Your folder: ' + j.folderURL, true);
            form.reset();
          } else {
            show('Error: ' + (j.error || 'Unknown'), false);
          }
        } catch (e) {
          show('Network error: ' + e, false);
        }
      });
    })();
  </script>
</body>
</html>
